<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Talkomatic Room</title>
  <link rel="stylesheet" href="stylesheets/room.css">
  <link rel="icon" type="image/png" href="images/icons/favicon.png">
</head>
<body>
  <div class="page-container">
    <nav class="top-navbar">
      <div class="navbar-section navbar-left">
        <div id="dateTime" class="date-time">
          <span class="date"></span>
          <span class="time"></span>
        </div>
      </div>
      <div class="navbar-section navbar-center">
        <div class="brand">Talkomaticâ„¢</div>
      </div>
      <div class="navbar-section navbar-right">
        <!-- Normal users see Mute Toggle; moderators see Settings icon -->
        <button id="muteToggle" class="mute-toggle" aria-label="Toggle Sound">
          <img src="images/icons/sound-on.svg" alt="Sound On" id="muteIcon">
        </button>
        <button id="roomSettingsBtn" class="room-settings" style="display:none;">
          <img src="images/icons/settings.svg" alt="Settings">
        </button>
        <div class="leave-room">Leave Room</div>
      </div>
    </nav>

    <div class="second-navbar">
      <div class="room-type">*</div>
      <div class="room-name">*</div>
      <div class="room-id">*</div>
    </div>

    <div class="chat-container"></div>

    <div class="invite-section">
      <div class="invite-text">Invite friends to your room with this link:</div>
      <div class="invite-container">
        <div class="invite-link" id="inviteLink"></div>
        <button id="copyInviteLink" aria-label="Copy invite link">
          <img src="images/icons/copy.svg" alt="Copy">
        </button>
      </div>
    </div>
  </div>

  <!-- Room Settings Modal (for overall room controls: doorbell mute and room lock) -->
  <div id="roomSettingsModal" class="modal">
    <div class="modal-content">
      <span id="roomSettingsModalClose" class="close-modal">&times;</span>
      <h2>Room Settings</h2>
      <div class="room-setting-item">
        <p id="doorbellStatus">Doorbell: Unmuted</p>
        <button id="toggleDoorbellBtn" class="modal-btn">Mute Doorbell</button>
      </div>
      <div class="room-setting-item">
        <p id="lockStatus">Room is currently Unlocked</p>
        <button id="toggleLockBtn" class="modal-btn">Lock Room</button>
      </div>
    </div>
  </div>

  <!-- User Settings Modal (for moderator actions on a target user) -->
  <div id="userSettingsModal" class="modal">
    <div class="modal-content">
      <span id="userSettingsModalClose" class="close-modal">&times;</span>
      <h2>User Moderation</h2>
      <div class="user-setting-item">
        <p>User: <span id="userModTargetName"></span></p>
        <p>Guest ID: <span id="userModTargetId"></span></p>
      </div>
      <div class="user-setting-actions">
        <button id="modKickBtn" class="modal-btn">Kick</button>
        <button id="modBanBtn" class="modal-btn">Ban</button>
        <button id="modMuteBtn" class="modal-btn">Mute (Global)</button>
        <button id="modPromoteBtn" class="modal-btn">Promote</button>
      </div>
    </div>
  </div>

  <audio id="joinSound" src="audio/ding.mp3"></audio>
  <audio id="leaveSound" src="audio/ding.mp3"></audio>

  <!-- Scripts -->
  <script nonce="<%= nonce %>" src="/socket.io/socket.io.js"></script>
  <!-- Renamed fingerprint.js is now users.js -->
  <script nonce="<%= nonce %>" src="js/users.js?v=1.0.3"></script>
  <script nonce="<%= nonce %>" src="js/init-socket-room.js?v=1.0.3"></script>
  <script nonce="<%= nonce %>" src="js/room-client.js?v=1.0.4"></script>
</body>
</html>
